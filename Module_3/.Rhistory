ls()
data(for.exercise)
snps.10
use <- seq(1, ncol(snps.10), 10)
head(use)
sub.10 <- snps.10[,use]
sub.10
snpdata = sub.10@.Data
head(subject.support)
status = subject.support$cc
head(status)
# Fit a linear model and a logistic regression model to the data for the 3rd SNP.
# What are the coefficients for the SNP variable? How are they interpreted? (Hint:
# Don't forget to recode the 0 values to NA for the SNP data)
# 1. B. Recode 0 values to NA
snp3 = as.numeric(snpdata[,3])
snp3[snp3==0] = NA
# 1. C. Fit a linear model
lm3 = lm(status ~ snp3)
tidy(lm3)
# 1. D. Fit a logistic regression model
glm3 = glm(status ~ snp3,family="binomial")
tidy(glm3)
# Question 3
# 3. A. Load the example SNP data with the following code:
library(snpStats)
library(broom)
ls()
data(for.exercise)
snps.10
use <- seq(1, ncol(snps.10), 10)
head(use)
sub.10 <- snps.10[,use]
sub.10
snpdata = sub.10@.Data
head(subject.support)
status = subject.support$cc
head(status)
# Fit a logistic regression model on a recessive (need 2 copies of minor allele
# to confer risk) and additive scale for the 10th SNP. Make a table of the fitted
# values versus the case/control status. Does one model fit better than the other?
# 3. B. fit a logistic regression model
snp10 = as.numeric(snpdata[,10])
snp10[snp10==0] = NA
glm10 = glm(status ~ snp10, family="binomial")
tidy(glm10)
# 3. C. Recessive Model
snp10_dom = (snp10 == 2)
glm10_dom = glm(status ~ snp10_dom, family="binomial")
tidy(glm10_dom)
# 3. D. Fitted values vs case/control status for logistic regression (additive model)
table(glm10$y, glm10$fitted.values)
# 3. E. Fitted values vs case/control status (Recessive model)
table(glm10_dom$y, glm10_dom$fitted.values)
glm10$y
# 3. B. fit a logistic regression model
snp10 = as.numeric(snpdata[,10])
snp10[snp10==0] = NA
glm10 = glm(status ~ snp10, family="binomial")
tidy(glm10)
# 3. C. Recessive Model
snp10_dom = (snp10 == 2)
glm10_dom = glm(status ~ snp10_dom, family="binomial")
tidy(glm10_dom)
# 3. D. Fitted values vs case/control status for logistic regression (additive model)
table(glm10$y, glm10$fitted.values)
# 3. E. Fitted values vs case/control status (Recessive model)
table(glm10_dom$y, glm10_dom$fitted.values)
glm10$fitted.values
# 3. B. fit a logistic regression model
snp10 = as.numeric(snpdata[,10])
snp10[snp10==0] = NA
glm10 = glm(status ~ snp10, family="binomial")
tidy(glm10)
# 3. C. Recessive Model
snp10_dom = (snp10 == 2)
glm10_dom = glm(status ~ snp10_dom, family="binomial")
tidy(glm10_dom)
# 3. D. Fitted values vs case/control status for logistic regression (additive model)
table(glm10$y, glm10$fitted.values)
# 3. E. Fitted values vs case/control status (Recessive model)
table(glm10_dom$y, glm10_dom$fitted.values)
library(snpStats)
library(broom)
ls()
data(for.exercise)
snps.10
use <- seq(1, ncol(snps.10), 10)
head(use)
sub.10 <- snps.10[,use]
sub.10
snpdata = sub.10@.Data
head(subject.support)
status = subject.support$cc
head(status)
# 4. B. Fit an additive logistic regression model to each SNP
results = rep(NA, dim(snpdata)[2])
for (i in 1:ncol(snpdata)){
snpdata_i = as.numeric(snpdata[,i])
snpdata_i[snpdata_i == 0] = NA
glm_i = glm(status ~ snpdata_i, family = "binomial")
results[i] = tidy(glm_i)$statistic[2]
}
# 4. C. Average effect size
mean(results)
# 4. D. Minimum effect size
min(results)
# 4. E. maximum effect size
max(results)
results = rep(NA, dim(snpdata)[2])
results
1:ncol(snpdata)
snpdata_i = as.numeric(snpdata[,i])
snpdata_i
results = rep(NA, dim(snpdata)[2])
for (i in 1:ncol(snpdata)){
snpdata_i = as.numeric(snpdata[,i])
snpdata_i[snpdata_i == 0] = NA
glm_i = glm(status ~ snpdata_i, family = "binomial")
results[i] = tidy(glm_i)$statistic[2]
}
results
ncol(snpdata)
snpdata_i
library(snpStats)
library(broom)
ls()
data(for.exercise)
snps.10
use <- seq(1, ncol(snps.10), 10)
head(use)
sub.10 <- snps.10[,use]
sub.10
snpdata = sub.10@.Data
head(subject.support)
status = subject.support$cc
head(status)
# 5. B. Square the coefficients
results_coeff_squre =  results^2
results_coeff_squre
# 5. C. Correlation with the results from using snp.rhs.tests and chi.squared
glm_all = snp.rhs.tests(status ~ 1, snp.data = sub.10)
cor(results_coeff_squre, chi.squared(glm_all))
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata)
fdata = fData(mp)
head(fdata)
# 7. A. Load the Montgomery and Pickrell eSet:
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata)
fdata = fData(mp)
head(fdata)
# First test for differences between the studies using the DESeq2 package using
# the DESeq function. Then do the log2(data + 1) transform and do the test for
# differences between studies using the limma package and the lmFit, ebayes and
# topTable functions. What is the correlation in the statistics between the two
# analyses? Are there more differences for the large statistics or the small
# statistics (hint: Make an MA-plot).
# 7. B.Load Libraries
library(DESeq2)
library(limma)
library(edge)
library(genefilter)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
glm_de = DESeq(de)
result_de = results(glm_de)
# 7. D. Using limma test the differences
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# o	0.75. There are more differences for the large statistics.
# o	0.63. There are more differences for the large statistics.
# o	0.93. There are more differences for the small statistics.
# o	0.36. There are more differences for the large statistics.
result_de
top
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
head(y)
tidy(result_de)
summary(result_de)
tidy(glm_de)
summary(glm_de)
View(glm_de)
result_de
top
# Question 8
# 8. A. DESeq analysis
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
# 8. B. limma analysis
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
# 7. B.Load Libraries
library(DESeq2)
library(limma)
library(edge)
library(genefilter)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
# 7. A. Load the Montgomery and Pickrell eSet:
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata)
fdata = fData(mp)
head(fdata)
# 7. B.Load Libraries
library(DESeq2)
library(limma)
library(edge)
library(genefilter)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
# 7. D. Using limma test the differences
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# 8. A. DESeq analysis
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
# 8. B. limma analysis
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
knitr::opts_chunk$set(echo = TRUE)
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata)
fdata = fData(mp)
head(fdata)
library(DESeq2)
library(limma)
library(edge)
library(genefilter)
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
cor(result_de$stat, top$t)
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata)
fdata = fData(mp)
head(fdata)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata, n = 1)
fdata = fData(mp)
head(fdata)
# 7. B.Load Libraries
library(DESeq2)
library(limma)
library(edge)
library(genefilter)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
# 7. D. Using limma test the differences
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# 8. A. DESeq analysis
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
# 8. B. limma analysis
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
de = DESeqDataSetFromMatrix(edata, pdata, ~study)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, design = ~study)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, design = ~study)
# 7. C. Using DESeq2 test the differences between the studies
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
pdata$study = factor(pdata$study)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
pdata$study = as.factor(pdata$study)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
pdata$study = as.numeric(as.factor(pdata$study))
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata, n = 1)
fdata = fData(mp)
head(fdata)
pdata$study = as.factor(pdata$study)
head(pdata)
pdata$study = as.numeric(as.factor(pdata$study))
head(pdata)
tail(pdata)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
# 7. D. Using limma test the differences
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# 8. A. DESeq analysis
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
# 8. B. limma analysis
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
pdata$study = as.numeric(as.factor(pdata$study))
head(pdata)
tail(pdata)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata, n = 1)
fdata = fData(mp)
head(fdata)
# 7. C. Using DESeq2 test the differences between the studies
pdata$study = as.numeric(as.factor(pdata$study))
head(pdata)
tail(pdata)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
# 7. D. Using limma test the differences
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
# 7. E. Correlation in the statistics between two analyses
cor(result_de$stat, top$t)
# 7. F. Make an MA-plot
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
# 8. A. DESeq analysis
fp_bh = p.adjust(result_de$pvalue, method="BH")
sum(fp_bh < 0.05)
# 8. B. limma analysis
fp_bh = p.adjust(top$P.Value, method="BH")
sum(fp_bh < 0.05)
library(devtools)
library(Biobase)
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/montpick_eset.RData")
load(file=con)
close(con)
ls()
mp = montpick.eset
mp
pdata=pData(mp)
head(pdata)
edata=as.data.frame(exprs(mp))
head(edata, n = 1)
fdata = fData(mp)
head(fdata)
de = DESeqDataSetFromMatrix(edata, pdata, design =~study)
glm_de = DESeq(de)
result_de = results(glm_de)
result_de
edata = log2(as.matrix(edata) + 1)
mod = model.matrix(~ as.factor(pdata$study))
fit_limma = lmFit(edata, mod)
ebayes_limma = eBayes(fit_limma)
top = topTable(ebayes_limma,number=dim(edata)[1], sort.by="none")
head(top)
cor(result_de$stat, top$t)
y = cbind(result_de$stat, top$t)
limma::plotMA(y)
